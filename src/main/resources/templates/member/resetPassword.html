<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/inc.html}">
<style layout:fragment="style">
    .inputPw {
        display: flex;
        flex-direction: column;
    }
    #modifyPw{
        width: 350px;
    }
    #modifyPwChk{
        width: 350px;
    }
</style>
<body class="align-middle" >
<div layout:fragment="content">

    <div class="container-fluid d-flex justify-content-center" style="height: 100vh;">
        <div class="card align-self-center">
            <div class="card-header">
                비밀번호 재설정
            </div>
            <div class="card-body" style="width: 500px;">
                <form id="fimResetPassword" action="/member/resetPassword" method="post">
                    <div class="input-group mb-3 inputPw">
                        <label>새로 사용할 비밀번호</label>
                        <input name="modifyPw" type="password" class="form-control" id="modifyPw">
                        <span id="modifyPWTxt" class="chkTxt"></span>
                    </div>
                    <div class="input-group mb-3 inputPw">
                        <label>비밀번호 확인</label>
                        <input type="password" class="form-control" id="modifyPwChk">
                        <span id="modifyPwCheckTxt" class="chkTxt"></span>
                    </div>
                    <div class="my-4">
                        <div class="float-end">
                            <button type="reset" class="btn btn-secondary"> 초기화 </button>
                            <button type="button" class="btn btn-primary" id="editPwBtn" disabled> 비밀번호 변경 </button>
                        </div>
                    </div>
                </form>
            </div> <!--End Card-Body-->
        </div> <!--End Card-->
    </div> <!--End Container-->

</div>
<script layout:fragment="script" th:inline="javascript">
    console.log([[${session.email}]]);
    console.log([[${session.isEmail}]]);

    const fimResetPassword = document.getElementById('fimResetPassword'); // 비밀번호 수정 form 태그

    const modifyPw = document.getElementById('modifyPw'); // 새로 사용할 비밀번호
    const modifyPwChk = document.getElementById('modifyPwChk'); // 새로 사용할 비밀번호 확인

    const modifyPWTxt = document.getElementById('modifyPWTxt'); // 새로 사용할 비밀번호 유효성 검사 텍스트
    const modifyPwCheckTxt = document.getElementById('modifyPwCheckTxt'); // 비밀번호 확인 유효성 검사 텍스트

    modifyPw.addEventListener('focusout', function (e) { // 새로 사용할 비밀번호 유효성 검사
        const mPwVal = modifyPw.value; // 비밀번호 값
        const pwRegex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*])[a-zA-Z\d!@#$%^&*]{8,12}$/; // 비밀번호 양식

        if (mPwVal === currentPw.value) { // 비밀번호가 전에 사용하던 비밀번호와 같다면
            modifyPWTxt.innerHTML = '전에 사용하던 비밀번호는 사용할 수 없습니다.';
            modifyPWTxt.style.color = '#f64e4e';

        } else if (!pwRegex.test(mPwVal) || mPwVal === ''.trim()) { // 비밀번호 양식이 맞지 않거나 비어있다면
            modifyPWTxt.innerHTML = '비밀번호는 영문 대소문자, 숫자, ' +
                '특수문자(!,@,#,$,%,^,&,*)를 포함하여 8~12자 사이로 입력해주세요.';
        } else { // 모든 유효성을 통과 했다면
            modifyPWTxt.innerHTML = '사용가능한 비밀번호 입니다.';
            modifyPWTxt.style.color = '#5c6ff1';
        }
    });

    modifyPwChk.addEventListener('keyup', function (e) { // 비밀번호 확인 유효성 검사
        const mPwChkVal = modifyPwChk.value; // 입력한 비밀번호 확인
        const mPWVal = modifyPw.value; // 입력한 비밀번호

        if (mPwChkVal !== mPWVal) { // 비밀번호와 비밀번호 확인이 다르다면
            modifyPwCheckTxt.innerHTML = '비밀번호가 일치하지 않습니다.'
            modifyPwCheckTxt.style.color = '#f64e4e';
        } else { // 일치한다면
            modifyPwCheckTxt.innerHTML = '비밀번호가 일치합니다.';
            modifyPwCheckTxt.style.color = '#5c6ff1';
            editPwBtn.disabled = false;
        }
    });

    const editPwBtn = document.getElementById('editPwBtn');
    editPwBtn.addEventListener('click', function (e) {
        console.log(fimResetPassword);
        fimResetPassword.submit();
    });

</script>
</body>
