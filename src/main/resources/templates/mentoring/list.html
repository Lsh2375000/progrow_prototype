<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/inc.html}">


<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Main</title>
</head>


<div layout:fragment="content">
  <br><br><br><br><br>
  <form action="/mentoring/list" method="get">
    <table>
      <tr>
        <td width="100%" align="left">
          <select name="type" class="txt">
            <option value="l" th:selected="${pageRequestDTO.type=='l'}">사용 언어</option>
            <option value="r" th:selected="${pageRequestDTO.type=='r'}">지역</option>
            <option value="i" th:selected="${pageRequestDTO.type=='i'}">id</option>
          </select> <input name="keyword" type="text"/>
          <input type="submit" id="btnAdd" class="btn btn-primary" value="검색"/>
        </td>
        <td width="100%" align="right">
          <a href="/mentoring/register" onclick="checkForm(); return false;" class="btn btn-primary">글쓰기</a>
        </td>
      </tr>
    </table>
  </form>
  <div style="padding-top: 50px">

    <table class="table table-hover">
      <tr>
        <th>번호</th>
        <th>멘토 ID</th>
        <th>멘티수(최대)</th>
        <th>지역</th>
        <th>주 언어</th>
        <th>작성일</th>
        <th>사전만남여부</th>
        <th>온/오프라인</th>
        <th>가입하기</th>
      </tr>
      <tr th:each="dto:${responseDTO.dtoList}">
        <td>[[${dto.mNo}]]</td>
        <td id="mID">[[${dto.id}]]</td>
        <td>[[${dto.menteeNum}]]</td>
        <td>[[${dto.region}]]</td>
        <td>[[${dto.lngName}]]</td>
        <td>[[${dto.addDate}]]</td>
        <td>[[${dto.meeting}]]</td>
        <td>[[${dto.on_off}]]</td>
        <td>
          <button class="btn btn-info recruit" th:value="${dto.mNo}">가입하기</button>
        </td>
      </tr>
    </table>

  </div>
  <!--  모달창-->
  <!--    <script type="text/javascript" th:src="@{/js/modalTest.js}"></script>-->
  <div class="modal registerModal" tabindex="-1" >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Recruit Mentoring</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">


        </div>
        <div class="modal-footer">
          <a class="btn btn-info recruitBtn" th:each="dto:${responseDTO.dtoList}" th:href="|@{/mentoring/recruit(mNo=${dto.mNo})}|">가입하기</a>
          <button type="button" class="btn btn-outline-dark closeRegisterBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--  모달창 끝-->

  <div class="float-end">
    <ul class="pagination flex-wrap">
      <li class="page-item" th:if="${responseDTO.prev}">
        <a class="page-link" th:data-num="${responseDTO.start - 1}">Previous</a>
      </li>
      <th:block th:each="i: ${#numbers.sequence(responseDTO.start, responseDTO.end)}">
        <li th:class="${responseDTO.page==i} ? 'page-item active' : 'page-item'">
          <a class="page-link" th:data-num="${i}">[[${i}]]</a>
        </li>
      </th:block>
      <li class="page-item" th:if="${responseDTO.next}">
        <a class="page-link" th:data-num="${responseDTO.end+1}">Next</a>
      </li>
    </ul>
  </div>
</div>

<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>-->
<script layout:fragment="script" th:inline="javascript">
  document.querySelector('.pagination').addEventListener("click", function (e) {
    e.preventDefault();
    e.stopPropagation();

    const target = e.target;

    if (target.tagName !== 'A') return;

    const num = target.getAttribute("data-num");
    const formObj = document.querySelector("form");
    formObj.innerHTML += `<input type='hidden' name='page' value='${num}'>`;
    formObj.submit();
  });

  // modal
  const registerModal = new bootstrap.Modal(document.querySelector(".registerModal"));
  const closeRegisterBtn = document.querySelector(".closeRegisterBtn");
  const closeRegisterBtn2 = document.querySelector(".btn-close");

  const modal_body = document.querySelector(".modal-body");
  const recs = document.querySelectorAll(".recruit");
  // const mIDs = document.querySelectorAll(".mID");

  // <th>멘티수(최대)</th>
  // <th>지역</th>
  // <th>주 언어</th>
  // <th>작성일</th>
  // <th>사전만남여부</th>
  // <th>온/오프라인</th>

  for (let i = 0; i < recs.length; i++) {
    recs[i].addEventListener('click', function (event) {
      let mNo = recs[i].parentNode.parentNode.firstChild.nextSibling;
      // let whole = recs[i].parentNode.parentNode;
      let id = recs[i].parentNode.parentNode.firstElementChild.nextElementSibling;
      let menteeNum = recs[i].parentNode.parentNode.firstElementChild.nextElementSibling.nextElementSibling;
      let region = recs[i].parentNode.parentNode.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling;
      let lang = recs[i].parentNode.parentNode.firstElementChild.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling;
      // let meet = recs[i].parentNode.parentNode.firstElementChild.lastElementChild.previousElementSibling;
      // let on_off = recs[i].parentNode.parentNode.firstElementChild.lastElementChild;

      modal_body.innerHTML = "";

      console.log("mNo..." + mNo.innerHTML);

      console.log("test..." + id.innerHTML);

      modal_body.innerHTML += `멘토링 번호 : ` + mNo.innerHTML + `<br>`;
      modal_body.innerHTML += `멘토 아이디 : ` + id.innerHTML + `<br>`;
      modal_body.innerHTML += `멘티 수 : ` + menteeNum.innerHTML + `<br>`;
      modal_body.innerHTML += `지역 : ` + region.innerHTML + `<br>`;
      modal_body.innerHTML += `사용 언어 : ` + lang.innerHTML + `<br>`;
      // modal_body.innerHTML += `사전만남여부 : ` + meet.innerHTML + `<br>`;
      // modal_body.innerHTML += `온/오프라인 : ` + on_off.innerHTML + `<br>`;


      registerModal.show();

    });
  }


  // for (const rec of recs) {
  //     rec.addEventListener('click', function (event) {
  //         let mNo = rec.parentNode.parentNode.firstChild.nextSibling;
  //         let whole = rec.parentNode.parentNode;
  //         let test1 = rec.parentNode.previousSibling;
  //         // let test2 = new DOMParser().parseFromString(whole.innerHTML, 'text/html');
  //         // let test3 = test2.childNodes[1];
  //         // const id = document.getElementById("mID");
  //         // const test1 = rec.parentNode.parentNode.lastChild;
  //         modal_body.innerHTML = "";
  //
  //         console.log("mNo..." + mNo.innerHTML);
  //         console.log("whole..." + whole.innerText);
  //         console.log("test1..." + test1.innerText);
  //         // console.log("id..." + id);
  //         // console.log("test3..." + test3);
  //
  //         modal_body.innerHTML += `멘토링 번호 : ` + mNo.innerHTML + `<br>`;
  //         modal_body.innerHTML += `전체값 : ` + whole.innerText + `<br>`;
  //         modal_body.innerHTML += `test1 : ` + test1.innerHTML + `<br>`;
  //         // modal_body.innerHTML += `id : ` + id.innerHTML + `<br>`;
  //         // modal_body.innerHTML += `test3 : ` + test1.innerHTML + `<br>`;
  //
  //         registerModal.show();
  //     });
  // }

  closeRegisterBtn.addEventListener("click", function (e) {
    registerModal.hide();
    // modal_body.innerHTML = "";
  });
  closeRegisterBtn2.addEventListener("click", function (e) {
    // modal_body.innerHTML = "";
  });

</script>

</div>
</html>